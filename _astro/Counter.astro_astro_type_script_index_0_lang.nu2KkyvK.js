function c(n){return!isNaN(n)&&isFinite(n)&&n>=0}function I(n,e){if(!c(n))throw new Error(`Invalid start timestamp: ${n}`);if(!c(e))throw new Error(`Invalid end timestamp: ${e}`);if(e<n)return{years:0,months:0,days:0,hours:0,minutes:0,seconds:0,totalDays:0,totalHours:0};const i=e-n,s=Math.floor(i/86400),o=Math.floor(i/3600),l=new Date(n*1e3),r=new Date(e*1e3);let a=new Date(l),d=0,h=0,m=0;for(;;){const t=new Date(a);if(t.setUTCFullYear(t.getUTCFullYear()+1),t<=r)d++,a=t;else break}for(;;){const t=new Date(a);if(t.setUTCMonth(t.getUTCMonth()+1),t<=r)h++,a=t;else break}for(;;){const t=new Date(a);if(t.setUTCDate(t.getUTCDate()+1),t<=r)m++,a=t;else break}const v=r.getTime()-a.getTime(),u=Math.floor(v/1e3),g=Math.floor(u/3600),E=Math.floor(u%3600/60),w=u%60;return{years:d,months:h,days:m,hours:g,minutes:E,seconds:w,totalDays:s,totalHours:o}}const C=1696809120,y=1e3;class f{intervalId=null;isActive=!1;lastUpdateTime=0;rafId=null;isVisible=!0;errorCount=0;maxRetries=3;elements;constructor(){this.elements={years:document.getElementById("years-value"),months:document.getElementById("months-value"),days:document.getElementById("days-value"),hours:document.getElementById("hours-value"),minutes:document.getElementById("minutes-value"),seconds:document.getElementById("seconds-value"),altFormat:document.getElementById("counter-alt-format"),loadingOverlay:document.getElementById("loading-overlay"),errorBoundary:document.getElementById("error-boundary"),errorMessage:document.getElementById("error-message"),retryButton:document.getElementById("retry-button"),mainCounter:document.getElementById("main-counter")},this.init()}init(){this.showLoading(),this.elements.retryButton&&this.elements.retryButton.addEventListener("click",()=>{this.retry()}),setTimeout(()=>{try{this.hideLoading(),this.start()}catch(e){this.handleError(e)}},100),document.addEventListener("visibilitychange",()=>{this.isVisible=!document.hidden,document.hidden?this.pause():this.resume()}),window.addEventListener("focus",()=>{this.isVisible&&this.resume()}),window.addEventListener("blur",()=>{this.pause()}),window.addEventListener("beforeunload",()=>{this.stop()}),"memory"in performance&&window.addEventListener("beforeunload",()=>{this.cleanup()})}updateDisplay(e){this.updateTimeUnit("years",e.years),this.updateTimeUnit("months",e.months),this.updateTimeUnit("days",e.days),this.updateTimeUnit("hours",e.hours),this.updateTimeUnit("minutes",e.minutes),this.updateTimeUnit("seconds",e.seconds),this.elements.altFormat&&(this.elements.altFormat.textContent=`Total elapsed time: ${e.totalDays} days, ${e.totalHours} hours`),this.updateAriaLabels(e)}updateTimeUnit(e,i){const s=this.elements[e];if(!s)return;parseInt(s.textContent||"0")!==i&&(s.classList.add("updating"),s.textContent=i.toString(),setTimeout(()=>{s.classList.remove("updating")},200))}updateAriaLabels(e){["years","months","days","hours","minutes","seconds"].forEach(s=>{const o=this.elements[s];if(o){const l=e[s],r=o.nextElementSibling;r&&r.setAttribute("aria-label",`${l} ${s}`)}})}calculateCurrentElapsedTime(){const e=Math.floor(Date.now()/1e3);return I(C,e)}tick(){try{const e=Date.now();if(e-this.lastUpdateTime<y-50)return;this.lastUpdateTime=e;const i=this.calculateCurrentElapsedTime();this.rafId&&cancelAnimationFrame(this.rafId),this.rafId=requestAnimationFrame(()=>{this.updateDisplay(i),this.rafId=null}),this.errorCount=0}catch(e){this.handleError(e)}}showLoading(){this.elements.loadingOverlay&&this.elements.loadingOverlay.setAttribute("aria-hidden","false"),this.elements.mainCounter&&(this.elements.mainCounter.style.opacity="0.3")}hideLoading(){this.elements.loadingOverlay&&this.elements.loadingOverlay.setAttribute("aria-hidden","true"),this.elements.mainCounter&&(this.elements.mainCounter.style.opacity="1")}showError(e){this.elements.errorBoundary&&this.elements.errorBoundary.setAttribute("aria-hidden","false"),this.elements.errorMessage&&(this.elements.errorMessage.textContent=e),this.elements.mainCounter&&(this.elements.mainCounter.style.opacity="0.3")}hideError(){this.elements.errorBoundary&&this.elements.errorBoundary.setAttribute("aria-hidden","true"),this.elements.mainCounter&&(this.elements.mainCounter.style.opacity="1")}handleError(e){console.error("Counter error:",e),this.errorCount++,this.errorCount>=this.maxRetries?(this.showError(`Failed to update counter after ${this.maxRetries} attempts. ${e.message}`),this.stop()):console.warn(`Counter error ${this.errorCount}/${this.maxRetries}, continuing...`)}retry(){this.hideError(),this.errorCount=0,this.showLoading(),setTimeout(()=>{try{this.hideLoading(),this.start()}catch(e){this.handleError(e)}},500)}start(){this.isActive||(this.isActive=!0,this.tick(),this.intervalId=window.setInterval(()=>{this.tick()},y))}pause(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.isActive=!1}resume(){this.isActive||this.start()}stop(){this.pause(),this.cleanup()}cleanup(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),window.removeEventListener("focus",this.resume),window.removeEventListener("blur",this.pause),this.isActive=!1}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new f}):new f;
